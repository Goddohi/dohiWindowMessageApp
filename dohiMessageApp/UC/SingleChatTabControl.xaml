<UserControl x:Class="WalkieDohi.UC.SingleChatTabControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:entity="clr-namespace:WalkieDohi.Entity"
             Height="Auto" Width="Auto">
    <UserControl.Resources>
        <!-- 텍스트 메시지용 -->
        <DataTemplate DataType="{x:Type entity:TextMessage}">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Sender}" FontWeight="Bold"/>
                <TextBlock Grid.Column="1" Text="{Binding Text}" TextWrapping="Wrap"/>
            </Grid>
        </DataTemplate>

        <!-- 이미지 메시지용 -->
        <DataTemplate DataType="{x:Type entity:ImageMessage}">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Sender}" FontWeight="Bold"/>
                <Image Grid.Column="1" MaxWidth="500" MaxHeight="300" Stretch="Uniform" Source="{Binding Image}" />
            </Grid>
        </DataTemplate>

        <!-- 파일 메시지용 -->
        <DataTemplate DataType="{x:Type entity:FileMessage}">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Sender}" FontWeight="Bold"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="[파일] " Foreground="Blue"  FontWeight="Bold"/>
                    <TextBlock Text="{Binding FileName}" Foreground="Blue" ToolTip="클릭하여 파일 위치 보기"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ListBox x:Name="ChatList" 
         SelectionMode="Single"
         AllowDrop="True"
         ItemsSource="{Binding ChatMessages}"
         MouseDoubleClick="ChatList_MouseDoubleClick" 
         MouseRightButtonUp="ChatList_MouseRightButtonUp"
         PreviewKeyDown="ChatList_PreviewKeyDown" 
         DragEnter="ChatList_DragEnter"
         Drop="ChatList_Drop"
         ScrollViewer.VerticalScrollBarVisibility="Auto"
         Grid.Row="0" Margin="5">

            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel IsVirtualizing="True" VirtualizationMode="Recycling" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
        </ListBox>


        <Grid Grid.Row="1" Margin="5" VerticalAlignment="Center" HorizontalAlignment="Left">
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="50" Width="300*"/>
                <ColumnDefinition Width="80"/>
                <ColumnDefinition Width="100"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0" x:Name="InputBox"  Width="300" Height="30" Margin="0,0,5,0" PreviewKeyDown="InputBox_PreviewKeyDown" AcceptsReturn="True" />
            <Button  Grid.Column="1" x:Name="SendButton" 
                     Style="{StaticResource RoundedChatButtonStyle}" Content="전송" Width="60" Height="30"/>
            <Button  Grid.Column="2" Content="파일 전송" Margin="10,0,0,0" 
                     Style="{StaticResource RoundedChatButtonStyle}" Width="80" Height="30" Click="SendFileButton_Click"/>
        </Grid>
    </Grid>
</UserControl>